<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Admin Panel - TRS Tickets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #000000;
      color: #00ff41;
      padding: 2rem;
      line-height: 1.6;
    }
    .container { max-width: 1350px; margin: 0 auto; }

    /* Headers */
    h1 {
      color: #00ff41;
      font-size: 2rem;
      margin-bottom: 1rem;
      text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }
    h2 {
      color: #00ff41;
      font-size: 1.5rem;
      margin: 2.5rem 0 1rem;
      text-shadow: 0 0 8px rgba(0, 255, 65, 0.4);
    }

    /* Messages */
    .good, .bad {
      padding: .8rem 1.2rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      font-weight: 500;
    }
    .good {
      background: rgba(0, 255, 65, 0.1);
      border: 1px solid #00ff41;
      color: #00ff41;
    }
    .bad {
      background: rgba(255, 68, 68, 0.1);
      border: 1px solid #ff4444;
      color: #ff6666;
    }

    /* Form */
    #panelForm { margin-bottom: 2rem; }

    /* Grid */
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    /* Fieldset */
    fieldset {
      flex: 1 1 400px;
      min-width: 320px;
      background: rgba(0, 255, 65, 0.03);
      border: 1px solid rgba(0, 255, 65, 0.3);
      border-radius: 10px;
      padding: 1.5rem;
    }
    legend {
      color: #00ff41;
      font-weight: 600;
      font-size: 1.1rem;
      padding: 0 .5rem;
    }

    /* Labels */
    label {
      display: block;
      color: #00ff41;
      font-weight: 500;
      margin-bottom: .5rem;
      margin-top: 1rem;
    }
    label:first-of-type { margin-top: 0; }

    /* Inputs */
    input[type="text"],
    input[type="email"],
    input[name="channelId"],
    textarea,
    select {
      width: 100%;
      padding: .7rem 1rem;
      background: #0a0a0a;
      border: 1px solid #00ff41;
      border-radius: 6px;
      color: #00ff41;
      font-size: .9rem;
      font-family: inherit;
      outline: none;
      transition: all .2s;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #00ff41;
      box-shadow: 0 0 12px rgba(0, 255, 65, 0.3);
    }
    textarea {
      font-family: 'Courier New', monospace;
      resize: vertical;
      min-height: 100px;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(0, 255, 65, 0.02);
      border: 1px solid rgba(0, 255, 65, 0.3);
      border-radius: 8px;
      overflow: hidden;
      margin-top: 1rem;
    }
    thead {
      background: rgba(0, 255, 65, 0.1);
    }
    th, td {
      padding: .6rem .5rem;
      border: 1px solid rgba(0, 255, 65, 0.2);
      color: #00cc33;
      font-size: .85rem;
    }
    th {
      color: #00ff41;
      font-weight: 600;
      text-align: left;
    }
    table input, table select {
      font-size: .85rem;
      padding: .5rem .7rem;
    }

    /* Buttons */
    button,
    button[type="submit"],
    .add-btn {
      background: rgba(0, 255, 65, 0.15);
      border: 1px solid #00ff41;
      color: #00ff41;
      padding: .7rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      font-size: .9rem;
      transition: all .2s;
      display: inline-block;
    }
    button:hover,
    button[type="submit"]:hover,
    .add-btn:hover {
      background: rgba(0, 255, 65, 0.25);
      box-shadow: 0 0 12px rgba(0, 255, 65, 0.3);
    }
    button[type="submit"] {
      background: rgba(0, 255, 65, 0.2);
      font-size: 1rem;
      padding: .8rem 2rem;
      margin-top: 1rem;
    }
    .add-btn {
      margin-top: .8rem;
      padding: .6rem 1.2rem;
      font-size: .85rem;
    }

    /* Delete Button */
    .del-btn {
      background: rgba(255, 68, 68, 0.2);
      border: 1px solid #ff4444;
      color: #ff6666;
      padding: .4rem .7rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: .8rem;
      transition: all .2s;
    }
    .del-btn:hover {
      background: rgba(255, 68, 68, 0.3);
      box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
    }

    /* Actions */
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
    }
    .actions form {
      display: flex;
      gap: .5rem;
      align-items: center;
    }
    .actions input {
      min-width: 200px;
    }
    .actions button {
      white-space: nowrap;
    }

    /* Links */
    a {
      color: #00ff41;
      text-decoration: none;
      transition: all .2s;
    }
    a:hover {
      color: #00ff41;
      text-shadow: 0 0 8px rgba(0, 255, 65, 0.5);
    }
    a[role="button"] {
      background: rgba(0, 255, 65, 0.15);
      border: 1px solid #00ff41;
      color: #00ff41;
      padding: .7rem 1.5rem;
      border-radius: 6px;
      font-weight: 500;
      transition: all .2s;
      display: inline-block;
    }
    a[role="button"]:hover {
      background: rgba(0, 255, 65, 0.25);
      box-shadow: 0 0 12px rgba(0, 255, 65, 0.3);
    }

    /* Notes */
    .soft-note {
      font-size: .8rem;
      color: rgba(0, 255, 65, 0.7);
      margin-top: .5rem;
      line-height: 1.5;
    }
    .mini {
      font-size: .75rem;
      color: rgba(0, 255, 65, 0.6);
      margin-top: .3rem;
    }
    .placeholder-list {
      margin-bottom: .8rem;
    }
    .placeholder-list code {
      margin-right: .5rem;
    }

    /* Code */
    code {
      background: rgba(0, 255, 65, 0.1);
      color: #00ff41;
      border: 1px solid rgba(0, 255, 65, 0.3);
      padding: .2rem .5rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: .85rem;
    }

    /* Footer */
    footer {
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid rgba(0, 255, 65, 0.2);
      font-size: .8rem;
      color: rgba(0, 255, 65, 0.6);
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 768px) {
      body { padding: 1rem; }
      h1 { font-size: 1.5rem; }
      .grid { gap: 1rem; }
      fieldset { min-width: 100%; }
    }
  </style>
</head>
<body class="container">
  <h1>üé´ Ticket‚ÄëBot Panel</h1>

  <% if (msg==='saved')  { %><p class="good">‚úÖ Gespeichert.</p><% } %>
  <% if (msg==='sent')   { %><p class="good">üì§ Panel‚ÄëNachricht gesendet.</p><% } %>
  <% if (msg==='edited') { %><p class="good">‚úèÔ∏è Panel‚ÄëNachricht aktualisiert.</p><% } %>
  <% if (msg==='nopanel'){ %><p class="bad">‚ö†Ô∏è Keine gespeicherte Panel‚ÄëNachricht vorhanden.</p><% } %>
  <% if (msg==='error')  { %><p class="bad">‚ùå Fehler ‚Äì Konsole pr√ºfen.</p><% } %>

  <form method="POST" autocomplete="off" id="panelForm">
    <div class="grid">

      <!-- Topics -->
      <fieldset>
        <legend>Kategorien (Topics)</legend>
        <table>
          <thead>
            <tr><th>Label*</th><th>Value</th><th>Emoji</th><th>L√∂schen</th></tr>
          </thead>
          <tbody id="topicRows">
            <% (cfg.topics||[]).forEach(t=>{ %>
              <tr>
                <td><input name="label" value="<%= t.label %>" required></td>
                <td><input name="value" value="<%= t.value %>" placeholder="auto"></td>
                <td><input name="emoji" value="<%= t.emoji||'' %>"></td>
                <td><button type="button" class="del-btn" onclick="delRow(this)">‚úñ</button></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
        <button type="button" class="add-btn" onclick="addTopicRow()">‚ûï Topic</button>
        <p class="soft-note">Ist <b>Value</b> leer, wird es aus dem Label generiert (klein + Bindestriche).</p>
      </fieldset>

      <!-- Ticket Embed -->
      <fieldset>
        <legend>Ticket Embed Vorlage</legend>
        <p class="placeholder-list soft-note">Platzhalter: <code>{userMention}</code> <code>{userId}</code> <code>{topicLabel}</code> <code>{topicValue}</code> <code>{ticketNumber}</code></p>
        <label>Titel <input name="embedTitle" value="<%= cfg.ticketEmbed?.title || '' %>"></label>
        <label>Beschreibung <textarea name="embedDescription" rows="7"><%= cfg.ticketEmbed?.description || '' %></textarea></label>
        <label>Farbe (Hex) <input name="embedColor" value="<%= cfg.ticketEmbed?.color || '#2b90d9' %>" placeholder="#2b90d9"></label>
        <label>Footer <input name="embedFooter" value="<%= cfg.ticketEmbed?.footer || '' %>"></label>
      </fieldset>

      <!-- Panel Embed -->
      <fieldset>
        <legend>Panel (Dropdown) Embed</legend>
        <label>Panel Titel <input name="panelTitle" value="<%= cfg.panelEmbed?.title || '' %>"></label>
        <label>Panel Beschreibung <textarea name="panelDescription" rows="6"><%= cfg.panelEmbed?.description || '' %></textarea></label>
        <label>Panel Farbe (Hex) <input name="panelColor" value="<%= cfg.panelEmbed?.color || '#5865F2' %>" placeholder="#5865F2"></label>
        <label>Panel Footer <input name="panelFooter" value="<%= cfg.panelEmbed?.footer || '' %>"></label>
      </fieldset>

      <!-- Formular Felder -->
      <fieldset>
        <legend>Benutzer‚ÄëFormular Felder</legend>
        <p class="soft-note">Diese Felder MUSS der Nutzer beim Ticket erstellen ausf√ºllen (Modal √∂ffnet sich nach Themenwahl).</p>
        <table>
          <thead>
            <tr><th>Label*</th><th>Placeholder</th><th>Typ</th><th>Required</th><th>L√∂schen</th></tr>
          </thead>
          <tbody id="formRows">
            <% (cfg.formFields||[]).forEach(f=>{ %>
              <tr>
                <td><input name="ffLabel" value="<%= f.label %>" required></td>
                <td><input name="ffPlaceholder" value="<%= f.placeholder||'' %>"></td>
                <td>
                  <select name="ffType">
                    <option value="short" <%= f.type==='short'?'selected':'' %>>Kurz</option>
                    <option value="paragraph" <%= f.type==='paragraph'?'selected':'' %>>Lang</option>
                    <option value="number" <%= f.type==='number'?'selected':'' %>>Zahl</option>
                  </select>
                </td>
                <td style="text-align:center"><input type="checkbox" name="ffRequired" <%= f.required? 'checked':'' %>></td>
                <td><button type="button" class="del-btn" onclick="delRow(this)">‚úñ</button></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
        <button type="button" class="add-btn" onclick="addFormRow()">‚ûï Feld</button>
        <p class="soft-note mini">Typen: <b>short</b> = kurzer Text, <b>paragraph</b> = langer Text, <b>number</b> = numerisch (als Text gespeichert).</p>
        <label class="soft-note">FormFields (JSON Vorschau)
          <textarea id="formFieldsJson" name="formFieldsJson" rows="8"><%= JSON.stringify(cfg.formFields || [], null, 2) %></textarea>
        </label>
      </fieldset>

      <!-- Raw Topics JSON (optional) -->
      <fieldset>
        <legend>Topics JSON (optional)</legend>
        <p class="soft-note">Wird nur benutzt wenn keine Topic‚ÄëZeile (Label) vorhanden ist.</p>
        <label>Topics (JSON)
          <textarea name="topicsJson" rows="8" id="topicsJson"><%= JSON.stringify(cfg.topics || [], null, 2) %></textarea>
        </label>
      </fieldset>

    </div>
    <button type="submit">üíæ Speichern</button>
  </form>

  <hr>
  <h2>Panel‚ÄëNachricht Aktionen</h2>
  <div class="actions">
    <form action="/panel/send" method="POST">
      <input name="channelId" placeholder="Channel‚ÄëID" value="<%= cfg.panelChannelId || '' %>" required>
      <button>üì§ Senden</button>
    </form>
    <form action="/panel/edit" method="POST">
      <button>‚úèÔ∏è Bestehende bearbeiten</button>
    </form>
    <a href="/tickets" role="button" class="secondary">üìú Ticket Verlauf / History</a>
  </div>

  <footer>
    <p>Ticket‚ÄëBot Panel ‚Ä¢ √Ñnderungen speichern sofort in <code>config.json</code>.</p>
  </footer>

<script>
function delRow(btn){ const tr=btn.closest('tr'); if(tr) tr.remove(); syncFormJson(); syncTopicsPreview(); }
function addTopicRow(){ const tr=document.createElement('tr'); tr.innerHTML=`<td><input name="label" required></td><td><input name="value" placeholder="auto"></td><td><input name="emoji"></td><td><button type="button" class="del-btn" onclick="delRow(this)">‚úñ</button></td>`; document.getElementById('topicRows').appendChild(tr); }
function addFormRow(data={label:'',placeholder:'',type:'short',required:false}){ const tr=document.createElement('tr'); tr.innerHTML=`<td><input name="ffLabel" value="${esc(data.label)}" required></td><td><input name="ffPlaceholder" value="${esc(data.placeholder)}"></td><td><select name="ffType"><option value="short" ${data.type==='short'?'selected':''}>Kurz</option><option value="paragraph" ${data.type==='paragraph'?'selected':''}>Lang</option><option value="number" ${data.type==='number'?'selected':''}>Zahl</option></select></td><td style="text-align:center"><input type="checkbox" name="ffRequired" ${data.required?'checked':''}></td><td><button type="button" class="del-btn" onclick="delRow(this)">‚úñ</button></td>`; document.getElementById('formRows').appendChild(tr); syncFormJson(); }
function esc(s){return String(s).replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}
function syncFormJson(){ const labels=[...document.querySelectorAll('#formRows input[name="ffLabel"]')]; const arr=[]; labels.forEach((inp,idx)=>{ const label=inp.value.trim(); if(!label) return; const placeholder=document.querySelectorAll('#formRows input[name="ffPlaceholder"]')[idx].value.trim(); const type=document.querySelectorAll('#formRows select[name="ffType"]')[idx].value; const required=document.querySelectorAll('#formRows input[name="ffRequired"]')[idx].checked; const obj={label,type}; if(placeholder) obj.placeholder=placeholder; if(required) obj.required=true; arr.push(obj); }); document.getElementById('formFieldsJson').value=JSON.stringify(arr,null,2); }
function syncTopicsPreview(){ const labels=[...document.querySelectorAll('#topicRows input[name="label"]')]; if(!labels.length) return; const arr=[]; labels.forEach((inp,idx)=>{ const L=inp.value.trim(); if(!L) return; const V=document.querySelectorAll('#topicRows input[name="value"]')[idx].value.trim() || L.toLowerCase().replace(/\s+/g,'-'); const E=document.querySelectorAll('#topicRows input[name="emoji"]')[idx].value.trim(); arr.push(E?{label:L,value:V,emoji:E}:{label:L,value:V}); }); document.getElementById('topicsJson').value=JSON.stringify(arr,null,2); }
document.getElementById('formRows').addEventListener('input',syncFormJson);
document.getElementById('topicRows').addEventListener('input',syncTopicsPreview);
// Vor Submit leere Label-Zeilen entfernen
document.getElementById('panelForm').addEventListener('submit',()=>{ [...document.querySelectorAll('#topicRows tr')].forEach(tr=>{ if(!tr.querySelector('input[name="label"]').value.trim()) tr.remove(); }); syncFormJson(); });
</script>
</body>
</html>