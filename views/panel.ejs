<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Ticketâ€‘Bot Panel</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <style>
    body { max-width: 1200px; }
    table { width:100%; }
    table input { width:100%; }
    .grid { display:flex; flex-wrap:wrap; gap:1.5rem; }
    fieldset { flex:1 1 360px; min-width:340px; }
    textarea { width:100%; font-family: monospace; }
    .bad { border:1px solid #c33; padding:.5rem .75rem; }
    .good { border:1px solid #2b7; padding:.5rem .75rem; }
    .actions form { display:inline-block; margin-right:1rem; }
    footer { margin-top:3rem; font-size:.75rem; opacity:.6; }
    .placeholder-list code { margin-right:.4rem; }
  </style>
</head>
<body class="container">
  <h1>ğŸ« Ticketâ€‘Bot Panel</h1>

  <% if (msg==='saved')  { %><p class="good">âœ… Gespeichert.</p><% } %>
  <% if (msg==='sent')   { %><p class="good">ğŸ“¤ Panelâ€‘Nachricht gesendet.</p><% } %>
  <% if (msg==='edited') { %><p class="good">âœï¸ Panelâ€‘Nachricht aktualisiert.</p><% } %>
  <% if (msg==='nopanel'){ %><p class="bad">âš ï¸ Keine gespeicherte Panelâ€‘Nachricht vorhanden.</p><% } %>
  <% if (msg==='error')  { %><p class="bad">âŒ Fehler beim Vorgang â€“ Konsole prÃ¼fen.</p><% } %>

  <form method="POST" autocomplete="off">
    <div class="grid">

      <!-- Kategorien -->
      <fieldset>
        <legend>Kategorien (Topics)</legend>
        <table>
          <thead>
            <tr><th>Label</th><th>Value</th><th>Emoji</th></tr>
          </thead>
            <tbody id="rows">
            <% (cfg.topics||[]).forEach(t => { %>
              <tr>
                <td><input name="label" value="<%= t.label %>" required></td>
                <td><input name="value" value="<%= t.value %>"></td>
                <td><input name="emoji" value="<%= t.emoji %>"></td>
              </tr>
            <% }) %>
            </tbody>
        </table>
        <button type="button" onclick="addRow()">â• Zeile</button>
        <p style="font-size:.75rem;opacity:.7;margin-top:.5rem">
          * <b>Value</b> leer â‡’ wird automatisch aus Label (klein) generiert.
        </p>
      </fieldset>

      <!-- Ticket Embed -->
      <fieldset>
        <legend>Ticket Embed Vorlage</legend>
        <p class="placeholder-list" style="font-size:.75rem">
          Platzhalter:
          <code>{userMention}</code>
          <code>{userId}</code>
          <code>{topicLabel}</code>
          <code>{topicValue}</code>
          <code>{ticketNumber}</code>
        </p>
        <label>Titel
          <input name="embedTitle" value="<%= cfg.ticketEmbed?.title || '' %>">
        </label>
        <label>Beschreibung
          <textarea name="embedDescription" rows="6"><%= cfg.ticketEmbed?.description || '' %></textarea>
        </label>
        <label>Farbe (Hex)
          <input name="embedColor" value="<%= cfg.ticketEmbed?.color || '#2b90d9' %>" placeholder="#2b90d9">
        </label>
        <label>Footer
          <input name="embedFooter" value="<%= cfg.ticketEmbed?.footer || '' %>">
        </label>
      </fieldset>

      <!-- Panel Embed -->
      <fieldset>
        <legend>Panel (Dropdown) Embed</legend>
        <label>Panel Titel
          <input name="panelTitle" value="<%= cfg.panelEmbed?.title || '' %>">
        </label>
        <label>Panel Beschreibung
          <textarea name="panelDescription" rows="5"><%= cfg.panelEmbed?.description || '' %></textarea>
        </label>
        <label>Panel Farbe (Hex)
          <input name="panelColor" value="<%= cfg.panelEmbed?.color || '#5865F2' %>" placeholder="#5865F2">
        </label>
        <label>Panel Footer
          <input name="panelFooter" value="<%= cfg.panelEmbed?.footer || '' %>">
        </label>
      </fieldset>

      <!-- RAW JSON -->
      <fieldset>
        <legend>RAW JSON (Optional)</legend>
        <p style="font-size:.75rem;opacity:.8">
          Nur nutzen, wenn du komplette Arrays manuell pflegen willst.
        </p>
        <label>Topics (JSON)
          <textarea name="topicsJson" rows="8"><%= JSON.stringify(cfg.topics || [], null, 2) %></textarea>
        </label>
        <label>FormFields (JSON)
          <textarea name="formFieldsJson" rows="8"><%= JSON.stringify(cfg.formFields || [], null, 2) %></textarea>
        </label>
      </fieldset>

    </div>

    <button type="submit">ğŸ’¾ Speichern</button>
  </form>

  <hr>

  <h2>Panelâ€‘Nachricht Aktionen</h2>
  <div class="actions">
    <form action="/panel/send" method="POST">
      <input name="channelId" placeholder="Channelâ€‘ID" value="<%= cfg.panelChannelId || '' %>" required>
      <button>ğŸ“¤ Senden</button>
    </form>

    <form action="/panel/edit" method="POST">
      <button>âœï¸ Bestehende bearbeiten</button>
    </form>
  </div>

  <footer>
    <p>Ticketâ€‘Bot Panel â€¢ Ã„nderungen werden sofort in <code>config.json</code> gespeichert â€¢ Stelle sicher, dass der Bot Schreibrechte hat.</p>
  </footer>

  <script>
    function addRow(){
      const tr=document.createElement('tr');
      tr.innerHTML = `
        <td><input name="label" required></td>
        <td><input name="value"></td>
        <td><input name="emoji"></td>`;
      document.getElementById('rows').appendChild(tr);
    }
  </script>
</body>
</html>
