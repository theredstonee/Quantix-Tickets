<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Tickets √úbersicht</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <style>
    body { max-width: 1300px; }
    table { width:100%; font-size:.85rem; }
    th { white-space:nowrap; }
    .status-offen { color:#2bd94a; font-weight:600; }
    .status-geschlossen { color:#d92b2b; font-weight:600; }
    .prio-dot { font-size:1rem; }
    .grid { display:flex; gap:2rem; flex-wrap:wrap; }
    section { flex:1 1 600px; min-width:380px; }
    .counts { font-size:.8rem; opacity:.7; }
    .ticket-id { font-family:monospace; }
    .search { margin-bottom:1rem; }
  </style>
</head>
<body class="container">
  <header>
    <h1>üé´ Tickets √úbersicht</h1>
    <p class="counts">Gesamt: <strong><%= counts.all %></strong> ‚Äì Offen: <strong><%= counts.open %></strong> ‚Äì Geschlossen: <strong><%= counts.closed %></strong></p>
    <nav><a href="/panel">‚¨ÖÔ∏è Zur√ºck zum Panel</a></nav>
  </header>

  <form method="GET" class="search">
    <input type="text" name="q" placeholder="Suche (ID, Topic, UserID)" value="<%= q %>">
    <button>üîç Suche</button>
    <% if(q){ %><a href="/tickets">Reset</a><% } %>
  </form>

  <div class="grid">
    <section>
      <h2>üü¢ Offene Tickets (<%= open.length %>)</h2>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Prio</th>
            <th>Topic</th>
            <th>User</th>
            <th>Seit</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% if(open.length===0){ %>
            <tr><td colspan="6"><em>Keine offenen Tickets.</em></td></tr>
          <% } %>
          <% open.forEach(t => { const prio = (t.priority||0); const dots=['üü¢','üü†','üî¥']; %>
            <tr>
              <td class="ticket-id">#<%= t.id %></td>
              <td class="prio-dot"><%= dots[prio] %></td>
              <td><%= t.topic %></td>
              <td><code><%= t.userId %></code></td>
              <td><%= new Date(t.timestamp).toLocaleString('de-DE') %></td>
              <td class="status-offen">offen</td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </section>

    <section>
      <h2>üîí Geschlossene Tickets (<%= closed.length %>)</h2>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Prio</th>
            <th>Topic</th>
            <th>User</th>
            <th>Erstellt</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% if(closed.length===0){ %>
            <tr><td colspan="6"><em>Keine geschlossenen Tickets.</em></td></tr>
          <% } %>
          <% closed.forEach(t => { const prio = (t.priority||0); const dots=['üü¢','üü†','üî¥']; %>
            <tr>
              <td class="ticket-id">#<%= t.id %></td>
              <td class="prio-dot"><%= dots[prio] %></td>
              <td><%= t.topic %></td>
              <td><code><%= t.userId %></code></td>
              <td><%= new Date(t.timestamp).toLocaleString('de-DE') %></td>
              <td class="status-geschlossen">geschlossen</td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </section>
  </div>

  <footer style="margin-top:2rem;font-size:.7rem;opacity:.6">Ticket-Bot √úbersicht ‚Ä¢ Aktualisierung beim Neuladen ‚Ä¢ Daten aus tickets.json</footer>
</body>
</html>